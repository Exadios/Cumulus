===============================================================================
Building and installing Cumulus under X11 and Qt4.5.x for Linux/Unix

Last update: 2009-06-14 by Axel Pauli

SVN info: $Id$
===============================================================================

These are the instructions to build and install Cumulus from source under
Linux/Unix. The basic assumption is, that you will do it as normal user and
not as root!

Step 1)

You will need to set up a build environment for Qt4.5.x under X11. The
following components are mandatory:

  a) The g++ tool, GNUs C++ compiler
  b) The Qt tools qmake, moc and lrelease
  c) The Qt libraries libQtCore and libQtGui
  d) The Qt header files

The different Linux distributions do provide normally installable packages but
you can build too Qt from the sources.

If all Qt stuff is already available you can continue with step 2)

To build your own Qt from scratch download a X11/Qt release from
ftp.trolltech.com/qt/source. I recommend the release:

ftp://ftp.trolltech.com/qt/source/qt-x11-opensource-src-4.5.1.tar.bz2

I did the development with this release. For Cumulus you need the standard
Qt4 libraries libQtCore and libQtGui. If you want to debug cumulus together
with Qt it is recommend to activate the debug option during run of the
configure script.

Copy the Qt tar ball in a local directory of your Linux desktop and extract it
with:
  
  tar jxf qt-x11-opensource-src-4.5.1.tar.bz2

Call the configure script in the root directory of your Qt source tree with the
following options:

  ./configure -prefix /opt/qt4.5.1 -opensource -no-qt3support -no-xmlpatterns
              -no-phonon -no-phonon-backend -no-webkit -no-scripttools
              -no-openssl -nomake examples -nomake demos -nomake docs
              -nomake translations -no-nis -no-cups
              
Note, that all options must be passed on one line. If you want to set another
prefix option please do it now. The installation is done under this path and under /opt/... you need later on root rights. To build Qt with debugging on add the option -debug to the others.
            
If configure has finished successfully, call as next:

  make

That can take a while (houres). If make has finished successfully call:

  su -c 'make install'

For executing this command you need root rights to install the Qt installation
under /opt/... Please enter the root password when you ask for it.

Now you should have installed a Qt installation under the directory of your
-prefix option.

To use your own Qt version, you have to add the
<QT_INSTALLDIR>/bin component at the first position of your PATH variable.

e.g. BASH example

  PATH=/opt/qt4.5.1/bin:$PATH
  export PATH
	
  in the assumption, that <QT_INSTALLDIR> is '/opt/qt4.5.1'.

The PATH variable can be displayed by calling 'echo $PATH' on a shell
command line.

Step 2)

Check if you can call 'g++ --version' from a shell command line. You should
see some output like this:

  g++ (Gentoo 4.3.2-r3 p1.6, pie-10.1.5) 4.3.2
  
Check if you can call 'qmake -v' from a shell command line. You should
see some output like this:

  QMake version 2.01a
  Using Qt version 4.5.1 in ...
   
Check if you can call 'moc -v' from a shell command line. You should
see some output like this:

  Qt Meta Object Compiler version 61 (Qt 4.5.1)
   
If both checks are successfully Qt is right installed. If a call fails or you
see a version less than 4.5 check the PATH variable for containing the right
Qt bin directory at the first position (see above).

Step 3)

Download the Cumulus sources from the subversion archive or as snapshot tar ball.

a) Get it from subversion:

To checkout the source tree from the subversion archive you need an installed
subversion client on your Linux desktop. If the command 'svn --version' fails you
have not installed subversion. Alternatively you can download a snapshot tar ball.
See below how to do this.

Checkout a Cumulus snapshot file tree in a local directory of your Linux desktop
from the subversion archive with:

  1) svn co https://svn.kflog.org/svn/repos/cumulus/qt4/trunk
  2) svn export https://svn.kflog.org/svn/repos/cumulus/qt4/trunk

Variant 2) is free from any svn overhead like .svn directories.

To checkout a certain release you have to use a url which starts with:

  https://svn.kflog.org/svn/repos/cumulus/qt4/tags/
  
followed by a release tag e.g. Release_2.3.3. You can browse through the
Cumulus subversion archive with your internet browser to see the release tags.
Type in the following url:

  https://svn.kflog.org/svn/repos/cumulus
  
Maybe your browser will aks you to enable an exception rule for the KFLog
certificate, it is not officially signed. You have to commit the question to
get access to the archive. Under the path qt4/trunk you can see the latest
checked in sources. Releases are to find under the path qt4/tag.

b) Get it as snapshot tar ball:

You can also download a snapshot tar ball by using this link:

  http://www.kflog.org/fileadmin/user_upload/cumulus_snapshots/CumulusQt4-snapshot.tbz
  
Copy the tar ball in a local directory of your Linux desktop and extract it with:
  
  tar jxf CumulusQt4-snapshot.tbz

Step 4)

Go into the trunk directory of your subversion copy or in the root directory of
the extracted tar ball. To build the Cumulus application issue the following
command:

  make -f Makefile.X11
	
  The following make targets are available:
	
  all      Builds all parts of Cumulus
  clean    Cleans the build area and removes all generated objects.
           Use it after done modifications of qmake project files.
  install  Installs Cumulus under $(INSTALL_ROOT), normally /opt/cumulus

Step 5)

The installation structure of Cumulus is oriented on the Filesystem Hierarchy
Standard of Unix (www.pathname.com/fhs). The default installation directory of
the Cumulus application is therefore /opt/cumulus further called INSTALL_ROOT.

To install Cumulus issue the following command:

  su -c 'make -f Makefile.X11 install'

'su -c' is necessary for the installation under /opt/cumulus. You need root
rights do do that. Please enter the root password when you ask for it.
If you would prefer another installation place, you can change the installation
directory during call of 'make install' in the following way:

  make -f Makefile.X11 INSTALL_ROOT=<my-install-path> install

Step 6)

The needed map data (airfields, airspaces and landscape) have to be installed
under the following directory structure:

                   +-/airfields/ (Only Welt2000 data file is supported)
$HOME/cumulus/maps/+-/airspaces/ (Only OpenAir file format is supported)
                   +-/landscape/ (Use map data from KFLog's map room)

Note, that Cumulus does support airspace files only in openair
format and as airfield file the Welt2000 data file. The former support of
KFLog airspace and airfield files has been removed.

For airfields the Welt2000 data base has to be used. See in Cumulus online help
or under

http://www.kflog.org/fileadmin/user_upload/cumulus_help/en/cumulus-maps.html

for more information how to get it.

The landscape files can be downloaded from the KFLog Map room. Follow the link
below to get them.

http://www.kflog.org/maproom/ground-and-terrain-data

Step 7)

To start Cumulus issue the command:

  INSTALL_PATH/bin/cumulus

Personal stuff is stored under $HOME/cumulus. There you can find the task file
'tasks.tsk', the waypoint file 'cumulus.kwp' and the IGC log files.

The Cumulus configuration file is stored under $HOME/.config/Cumulus.conf.

To get more information about the Cumulus usage look in the online help of your
running Cumulus or under this link:

http://www.kflog.org/fileadmin/user_upload/cumulus_help/en/cumulus.html

Step 8)

Usage of NMEA Simulator

Under INSTALL_ROOT/bin you can find a NMEA simulator with name 'nmeaSimu'. You
can use it for generation of NMEA data. Call it without any arguments and you
will get a help usage displayed. The output of the simulator is written in a
named pipe. Select in Cumulus as GPS device /tmp/nmeasim and Cumulus will read
the data from the simulator.

Hints, improvements or help are always welcome. Please contact the maintainer of
Cumulus, Axel Pauli, via email axel@kflog.org or use the mailing lists of KFLog
to find under www.kflog.org/mailman/listinfo.

Have fun with Cumulus ...

===============================================================================
Licence of Cumulus
===============================================================================

This program is free software: you can redistribute it and/or modify it under
the terms of the GNU General Public License as published by the Free Software
Foundation, either version 3 of the License, or (at your option) any later
version.

This program is distributed in the hope that it will be useful, but WITHOUT ANY
WARRANTY; without even the implied warranty of MERCHANTABILITY or FITNESS FOR A
PARTICULAR PURPOSE. See the GNU General Public License
(www.gnu.org/copyleft/gpl.html) for more details.
